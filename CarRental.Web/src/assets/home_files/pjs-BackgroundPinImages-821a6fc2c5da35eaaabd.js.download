(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["BackgroundPinImages"],{MLsW:function(e,t,n){"use strict";n.r(t);var a=n("GyhR"),i=n.n(a),o=n("Ivf5"),r=n("mBmT"),s=n("cBxH"),l=n("zlIe"),u=n("9Y9K"),c=n("UmN8"),g=n("2YES"),d=n("+U6O"),h=n("3KWM"),p=n("k9eC");function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){function t(){var e,n,a,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,u=new Array(r),c=0;c<r;c++)u[c]=arguments[c];return a=this,o=(e=I(t)).call.apply(e,[this].concat(u)),n=!o||"object"!==m(o)&&"function"!=typeof o?_(a):o,v(_(_(n)),"state",{loading:!0,lpPinImages:[],shouldLoadProgressively:!1}),v(_(_(n)),"progressiveBackgroundImageIndices",l.a.welcome),v(_(_(n)),"selectedTopicImages",[]),v(_(_(n)),"shouldShowBackgroundWithSelectedTopicImages",function(){return!!n.selectedTopicImages&&n.selectedTopicImages.length>0&&(!!n.props.isInNux||!!n.props.isInRenux)&&["topic","loader"].includes(n.props.nuxStep)}),v(_(_(n)),"getUnauthPinImages",function(){return(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?s.a.getUnauthSessionsPins():s.a.getUnauthPins()).filter(function(e){return e.images&&e.images["236x"]}).map(function(e){return e.images["236x"]})}),v(_(_(n)),"renderPinImage",function(e){var t=e.data,n=t.height,a=t.url,o=t.width;return i.a.createElement(d.u,{shape:"rounded",wash:!0},i.a.createElement(d.p,{alt:"pin-image",src:a,naturalWidth:o,naturalHeight:n}))}),v(_(_(n)),"renderPinImageProgressively",function(e){var t=e.data,a=e.itemIdx,o=t.height,r=t.url,s=t.width,l=n.progressiveBackgroundImageIndices.indexOf(a)>=0;return i.a.createElement(d.u,{shape:"rounded",wash:!0},i.a.createElement(d.p,{alt:"pin-image",src:r,naturalWidth:s,naturalHeight:o},!l&&i.a.createElement(d.b,{dangerouslySetInlineStyle:{__style:{backgroundColor:"rgba(2, 4, 4, 0.6)",paddingBottom:"".concat(o/s*100,"%")}}})))}),n}var n,o,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,a["PureComponent"]),n=t,(o=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.isInNux,a=t.isInRenux,i=t.pinImages,o=void 0===i?[]:i,s=t.requestContext,l=this.getUnauthPinImages()||[],u=l[0],c=this.getUnauthPinImages(!0)||[],g=!1,d=!1;if(a&&(d=!0),c.length>1&&!a)if(n){new p.c(s,"web_nux_more_relevant_bg_pins").enabled()&&(d=!0)}else{var h=new p.b(s,"web_nux_home_login_page_relevant_bg_pins");s.experiments.flush(),h.check("enabled_related_pins")&&(g=!0),h.check("enabled_visited_pins")&&(d=!0)}var m=f(o);g&&(m=f(l).concat(f(m))),d&&(m=f(c).concat(f(m)));var b=(c[0]||{}).url!==(u||{}).url;(n||a)&&b&&(m=[u].concat(f(m)));var I=new p.c(s,"web_nux_progressive_bg_pins"),S={loading:!1,lpPinImages:m,shouldLoadProgressively:(a||n)&&I.enabled()};S.lpPinImages.length<15&&(S.lpPinImages=S.lpPinImages.concat(r.a)),setTimeout(function(){return e.setState(S)})}},{key:"UNSAFE_componentWillUpdate",value:function(e){var t=e.isInNux,n=e.isInRenux,a=e.nuxSelectedInterestImages,i=e.nuxStep,o=e.requestContext,r=this.state,s=r.lpPinImages,u=r.shouldLoadProgressively;i&&u&&(this.progressiveBackgroundImageIndices=l.a[i]);var c=!new p.b(o,"web_nux_picker_flip").checkWithNoActivation("enabled_flip_no_bg");if((t||n)&&"topic"===i&&c&&(this.selectedTopicImages=Array.from(s),a))for(var g=0;g<a.length&&g<this.selectedTopicImages.length;g+=1)this.selectedTopicImages[g]=a[g]}},{key:"render",value:function(){var e=this,t=this.props.disableFlexibleBGPins,n=this.state,a=n.loading,o=n.lpPinImages,r=n.shouldLoadProgressively;return!a&&o&&i.a.createElement(c.a,{name:"web_homefeed_nux"},function(n){var a=n.anyEnabled;return i.a.createElement(d.b,{bottom:!0,left:!0,maxHeight:2500,overflow:"hidden",paddingY:6,paddingX:5,position:a?"relative":"absolute",right:!0,top:!0,dangerouslySetInlineStyle:{__style:{pointerEvents:"none"}}},i.a.createElement(d.v,{flexible:!t,comp:r?e.renderPinImageProgressively:e.renderPinImage,gutterWidth:Object(h.j)(!0),items:e.shouldShowBackgroundWithSelectedTopicImages()?e.selectedTopicImages:o,minCols:h.g}))})}}])&&b(n.prototype,o),u&&b(n,u),t}();t.default=Object(u.compose)(Object(o.connect)(function(e){return{nuxSelectedInterestImages:e.ui.nuxSelectedInterestImages&&e.ui.nuxSelectedInterestImages.images,nuxStep:e.ui.nuxProgress&&e.ui.nuxProgress.step}},null),g.e)(y)},cBxH:function(e,t,n){"use strict";var a=n("WQSK"),i=n("D+W/"),o=n("PhUE"),r=n("ggpB"),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:604800,n=window.localStorage.getItem(e);return n&&Date.now()-parseInt(n,10)>1e3*t},l={logUrl:function(){if(o.b.localStorage.getItem("lastVisitedPage")!==window.location.pathname){o.b.localStorage.prependItem("visitedPages",{path:window.location.pathname,ts:Date.now()},i.a.MAX_STORED_VISITED_PAGES);try{o.b.localStorage.setItem("lastVisitedPage",window.location.pathname)}catch(e){console.error(e)}}},logUrlAndFirstPinImageSig:function(e){if(o.b.localStorage.getItem("lastVisitedPage")!==window.location.pathname){var t={path:window.location.pathname,ts:Date.now(),first_pin_image_signature:e||""};o.b.localStorage.prependItem("visitedPages",t,i.a.MAX_STORED_VISITED_PAGES),o.b.sessionStorage.prependItem("sessionVisitedPages",t,i.a.MAX_STORED_VISITED_PAGES),Object(r.a)("unauth.web.session.visited_pins."+o.b.sessionStorage.getItem("sessionVisitedPages").length),o.b.localStorage.prependItem("visitedPagesBeforeLogin",t,i.a.MAX_STORED_VISITED_PAGES);try{o.b.localStorage.setItem("lastVisitedPage",window.location.pathname)}catch(e){console.error(e)}}},logLastVisitedPinLandingPage:function(e,t){if(e){var n=o.b.localStorage.getItem("visitedPinLandingPagesBeforeLogin");if(n){var a=!0,r=!1,s=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;if(c&&c.id===e.id)return}}catch(e){r=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(r)throw s}}}var g={ts:Date.now(),path:window.location.pathname,id:e.id,image_signature:e.image_signature,is_shared_pin:t};o.b.localStorage.prependItem("visitedPinLandingPagesBeforeLogin",g,i.a.MAX_STORED_VISITED_PIN_PAGES)}},logLastVisitedBoardLandingPage:function(e){if(e&&e.board){var t=o.b.localStorage.getItem("visitedBoardLandingPagesBeforeLogin");if(t){var n=!0,a=!1,r=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=s.value;if(u&&u.board_id===e.board.id)return}}catch(e){a=!0,r=e}finally{try{n||null==l.return||l.return()}finally{if(a)throw r}}}var c={ts:Date.now(),board_id:e.board.id,first_pin_id:e.id,first_pin_image_signature:e.image_signature};o.b.localStorage.prependItem("visitedBoardLandingPagesBeforeLogin",c,i.a.MAX_STORED_VISITED_PIN_PAGES)}},logPinCTAClick:function(e){o.b.localStorage.prependItem("visitedPages",{path:e,ts:Date.now(),actions:[1]},i.a.MAX_STORED_VISITED_PAGES)},logPinPage:function(e){var t=a.get("lastVisitedPinPages");if(e&&e.id)if(t){var n=JSON.parse(t);n.length>=i.a.MAX_STORED_VISITED_PIN_PAGES&&n.shift(),n.push(e.id),a.set("lastVisitedPinPages",JSON.stringify(n)),Object(r.a)("unauth_pin_cookie."+n.length)}else a.set("lastVisitedPinPages",JSON.stringify([e.id]))},logPinCloseup:function(e){if(e&&e.id){var t={id:e.id,ts:Date.now()};e.image&&(t.image=e.image);var n=o.b.localStorage.getItem("unauthPinCloseup");if(n){Array.isArray(n[0])&&(o.b.localStorage.removeItem("unauthPinCloseup"),n=[]);for(var a=0;a<n.length;a+=1)n[a].id===t.id&&n.splice(a,1),a>=i.a.MAX_STORED_VISITED_PINS&&n.shift();n.push(t)}else n=[t];try{o.b.localStorage.setItem("unauthPinCloseup",n)}catch(e){console.error(e)}}},logTopicClick:function(e){if(e&&e.id&&e.name){var t={id:e.id,ts:Date.now(),name:e.name},n="";if(e.images){var a=Object.keys(e.images);a.length>0&&e.images[a[0]].url&&(n=e.images[a[0]].url)}else e.image&&(n=e.image);t.imageUrl=n,e.background_color&&(t.backgroundColor=e.background_color);var r=o.b.localStorage.getItem("unauthTopicVisit");if(r){Array.isArray(r[0])&&(o.b.localStorage.removeItem("unauthTopicVisit"),r=[]);for(var s=0;s<r.length;s+=1)r[s].id===t.id&&r.splice(s,1),s>=i.a.MAX_STORED_VISITED_TOPICS&&r.shift();r.push(t)}else r=[t];try{o.b.localStorage.setItem("unauthTopicVisit",r)}catch(e){console.error(e)}}},hasClickedPins:function(){var e=o.b.localStorage.getItem("unauthPinCloseup");return e&&e.length>0},getRecentClickedPins:function(e){var t=o.b.localStorage.getItem("unauthPinCloseup");return this._getRecentItems(e,t)},getRecentClickedTopics:function(e){var t=o.b.localStorage.getItem("unauthTopicVisit");return this._getRecentItems(e,t)},_getRecentItems:function(e,t){return t?t.length<=e?t:t.slice(t.length-e):[]},getLastVisitedFeedInfo:function(){var e=o.b.localStorage.getItem("lastVisitedPage"),t=[];if(!e)return null;if((t=e.split("/")).length<4)return null;var n=t[1],a=t[2];switch(n){case"pin":return{pageType:"pin",id:a};case"explore":return{pageType:"explore",id:a};default:return null}},logUnauthImageFeed:function(e){var t=e.map(function(e){return e.images&&e.images["170x"]&&e.images["170x"].url}).filter(function(e){return!!e});if(t.length)try{o.b.localStorage.setItem("unauthRecentImageFeed",t)}catch(e){console.error(e)}},getUnauthImageFeed:function(){return o.b.localStorage.getItem("unauthRecentImageFeed")||[]},logUnauthPins:function(e){if(e.length)try{o.b.localStorage.setItem("unauthPins",e),o.b.sessionStorage.prependItem("sessionUnauthPins",e[0])}catch(e){console.error(e)}},getUnauthPins:function(){return o.b.localStorage.getItem("unauthPins")||[]},getUnauthSessionsPins:function(){return o.b.sessionStorage.getItem("sessionUnauthPins")||[]},getUnauthCloseupCount:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:604800,t=o.b.localStorage.getItem("unauthHybridCloseupCount");return s("unauthHybridCloseupTS",e)||!t?0:parseInt(t,10)||0},logUnauthHybridCloseup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:604800,t=this.getUnauthCloseupCount();if(s("unauthHybridCloseupTS",e)||!t)try{o.b.localStorage.setItem("unauthHybridCloseupCount",1),o.b.localStorage.setItem("unauthHybridCloseupTS",Date.now())}catch(e){console.error(e)}else try{o.b.localStorage.setItem("unauthHybridCloseupCount",t+1)}catch(e){console.error(e)}},getUnauthClickthroughCount:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:604800,t=o.b.localStorage.getItem("unauthHybridClickthroughCount");return s("unauthHybridClickthroughTS",e)||!t?0:parseInt(t,10)||0},logUnauthHybridClickthrough:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:604800,t=this.getUnauthClickthroughCount();if(s("unauthHybridClickthroughTS",e)||!t)try{o.b.localStorage.setItem("unauthHybridClickthroughCount",1),o.b.localStorage.setItem("unauthHybridClickthroughTS",Date.now())}catch(e){console.error(e)}else try{o.b.localStorage.setItem("unauthHybridClickthroughCount",t+1)}catch(e){console.error(e)}},logLoginSignupModalView:function(){try{o.b.localStorage.setItem("unauthHybridLoginModalView",Date.now())}catch(e){console.error(e)}},getLoginSignupModalView:function(){return o.b.localStorage.getItem("unauthHybridLoginModalView")||0}};t.a=l}}]);
//# sourceMappingURL=pjs-BackgroundPinImages-821a6fc2c5da35eaaabd.js.map
